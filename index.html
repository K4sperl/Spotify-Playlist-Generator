<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Playlist Generator</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #333; /* Dunkler Hintergrund für Dark Mode */
            color: #fff; /* Weißer Text für bessere Lesbarkeit */
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #444; /* Dunklerer Hintergrund für das Formular */
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            text-align: left; /* Text linksbündig für Playlist */
        }
        h1 {
            color: #1DB954; /* Grün für den Titel */
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #fff; /* Weißer Text für Labels */
        }
        input[type="text"], input[type="number"] {
            width: calc(100% - 20px);
            padding: 8px;
            margin-bottom: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            background-color: #555; /* Dunklerer Hintergrund für Eingabefelder */
            color: #fff; /* Weißer Text für Eingabefelder */
            box-sizing: border-box;
        }
        button {
            background-color: #1DB954; /* Grün für den Button */
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        button.cancel-button {
            background-color: #ff4d4d; /* Rot für den Abbrechen-Button */
            margin-left: 10px;
        }
        button:hover {
            background-color: #1ed760; /* Dunkleres Grün im Hover-Zustand */
        }
        p.error-message {
            color: #ff4d4d; /* Rotes für Fehlermeldungen */
            font-size: 14px;
            margin-top: 8px;
            display: none; /* Fehlermeldung zunächst ausblenden */
        }
        .playlist {
            margin-top: 20px;
            border-top: 1px solid #666; /* Trennlinie für Playlist */
            padding-top: 10px;
        }
        .song-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .song-item img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            border-radius: 4px;
        }
        .song-item .song-info {
            flex: 1;
        }
        .song-item .song-info h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
        }
        .song-item .song-info p {
            margin: 0;
            font-size: 14px;
            color: #ccc;
        }
        .related-playlists {
            margin-top: 20px;
            display: none; /* Verstecke ähnliche Playlists zu Beginn */
        }
        .related-playlists.active {
            display: block; /* Zeige ähnliche Playlists nach Generierung */
        }
        .related-playlists h2 {
            color: #1DB954;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .related-playlist-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .related-playlist-item img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            border-radius: 4px;
        }
        .related-playlist-item .playlist-info {
            flex: 1;
        }
        .related-playlist-item .playlist-info h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
        }
        .related-playlist-item .playlist-info p {
            margin: 0;
            font-size: 14px;
            color: #ccc;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Spotify Playlist Generator</h1>

        <button id="loginButton" onclick="toggleSpotifyLogin()">Mit Spotify anmelden</button>
        <p id="loggedInStatus" style="display: none;">Angemeldet als: <span id="loggedInUser"></span> (<a href="#" onclick="logout()">Abmelden</a>)</p>

        <label for="inputField">Beschreibung:</label>
        <input type="text" id="inputField" placeholder="Gib hier deine Beschreibung ein">

        <label for="numSongs">Anzahl der Lieder:</label>
        <input type="number" id="numSongs" min="10" max="10000">

        <button onclick="validateAndGenerate()">Generieren Playlist</button>
        <button class="cancel-button" onclick="reloadPage()">Abbrechen</button>
        <button id="saveToSpotifyButton" style="display: none;" onclick="saveToSpotify()">Auf Spotify speichern</button>

        <p id="generatedCount" style="display: none;">0/0 Liedern generiert</p>

        <div class="playlist" id="playlist">
            <!-- Hier werden die generierten Songs angezeigt -->
        </div>

        <div class="related-playlists" id="relatedPlaylists">
            <h2>Ähnliche Playlists auf Spotify</h2>
            <!-- Hier werden ähnliche Playlists angezeigt -->
        </div>

        <p id="errorMessage" class="error-message"></p>

        <!-- Verstecktes Div für benutzerdefinierten Text -->
        <div id="customText" style="display: none;">
            <!-- Hier kannst du deinen benutzerdefinierten Text als Vorlage eingeben -->
            <!-- Dieser Text wird im JavaScript als Vorlage verwendet, aber nicht auf der Website angezeigt -->
            Erstellt von K4sperl Musikdatenbank bereitgestellt von Spotify. Mithilfe von ChatGPT, MicrosoftCopilot und BlackBox.ai habe ich das hier geschafft und es ist erstaunlich was man mit etwas Geduld mit Ai erreichen kann.
        </div>
    </div>

    <script>
        // Client ID und Client Secret
        const CLIENT_ID = '0fe8c6577bda455581b8b36be7631e25';
        const CLIENT_SECRET = '94a10806a4544e8a854d0a7ac9dc7636';
        const REDIRECT_URI = 'https://k4sperl.github.io/Spotify-Playlist-Generator.github.io';

        // Funktion zum Autorisieren mit Spotify
        function authorizeSpotify() {
            var scopes = 'playlist-read-private playlist-read-collaborative user-read-private';
            var authUrl = 'https://accounts.spotify.com/authorize';
            let state = generateRandomString(16);
            let url = `${authUrl}?response_type=token`;
            url += `&client_id=${CLIENT_ID}`;
            url += `&scope=${encodeURIComponent(scopes)}`;
            url += `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`;
            url += `&state=${state}`;

            // Öffne den Authorization-Link in einem neuen Tab
            window.open(url, '_blank');

            // Setze einen Interval um den Popup-Status zu überwachen
            var interval = setInterval(function() {
                if (window.location.href.includes('#access_token=')) {
                    clearInterval(interval);
                    var accessToken = window.location.href.split('access_token=')[1].split('&')[0];
                    localStorage.setItem('accessToken', accessToken);
                    getUserInfo(accessToken);
                }
            }, 100);
        }

        // Funktion zum Erzeugen eines zufälligen Strings für den Zustand
        function generateRandomString(length) {
            var text = '';
            var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            for (var i = 0; i < length; i++) {
                text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            return text;
        }

        // Funktion um Benutzerinformationen von Spotify abzurufen
        function getUserInfo(accessToken) {
            fetch('https://api.spotify.com/v1/me', {
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            })
            .then(response => response.json())
            .then(data => {
                localStorage.setItem('userDisplayName', data.display_name);
                document.getElementById('loggedInUser').innerText = data.display_name;
                document.getElementById('loggedInStatus').style.display = 'block';
                document.getElementById('loginButton').style.display = 'none';
            })
            .catch(error => console.error('Error fetching user info:', error));
        }

        // Funktion zum Abmelden des Benutzers
        function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('userDisplayName');
            document.getElementById('loggedInUser').innerText = '';
            document.getElementById('loggedInStatus').style.display = 'none';
            document.getElementById('loginButton').style.display = 'block';
        }

        // Funktion zum Überprüfen und Generieren der Playlist
        function validateAndGenerate() {
            var description = document.getElementById('inputField').value;
            var numSongs = parseInt(document.getElementById('numSongs').value);

            // Überprüfe, ob die Anzahl der Lieder gültig ist
            if (isNaN(numSongs) || numSongs < 10 || numSongs > 10000) {
                document.getElementById('errorMessage').innerText = 'Die Anzahl der Lieder muss zwischen 10 und 10.000 liegen.';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }

            // Setze den Fehler-Text auf leer und verstecke ihn
            document.getElementById('errorMessage').innerText = '';
            document.getElementById('errorMessage').style.display = 'none';

            // Generiere die Playlist
            generatePlaylist(description, numSongs);
        }

        // Funktion zum Generieren und Anzeigen der Playlist
        function generatePlaylist(description, numSongs) {
            document.getElementById('playlist').innerHTML = ''; // Leere die Playlist vor der Generierung
            document.getElementById('generatedCount').innerText = `0/${numSongs} Liedern generiert`;
            document.getElementById('generatedCount').style.display = 'block';

            // Hier müsste die Funktion searchSongs implementiert werden, um Songs von Spotify zu suchen
            // Beispiel: searchSongs(description, numSongs);

            // Zeige den Button zum Speichern der Playlist an
            document.getElementById('saveToSpotifyButton').style.display = 'block';

            // Hier könnten weitere Aktionen nach der Generierung der Playlist erfolgen, z.B. das Anzeigen ähnlicher Playlists
            // Beispiel: showRelatedPlaylists();
        }

        // Funktion zum Speichern der Playlist auf Spotify
        function saveToSpotify() {
            var playlistName = document.getElementById('inputField').value;
            var songs = []; // Hier müssten die gesammelten Songs gespeichert werden
            // Beispiel: savePlaylist(playlistName, songs);
            alert(`Die Playlist "${playlistName}" wurde erfolgreich auf Spotify gespeichert!`);
        }

        // Funktion zum Anzeigen ähnlicher Playlists auf Spotify
        function showRelatedPlaylists() {
            document.getElementById('relatedPlaylists').classList.add('active');
            // Hier könnten ähnliche Playlists von Spotify geladen und angezeigt werden
            // Beispiel: fetchRelatedPlaylists();
        }

        // Funktion zum Neuladen der Seite (Abbrechen-Button)
        function reloadPage() {
            location.reload();
        }

        // Funktion zum Wechseln des Spotify-Anmeldestatus
        function toggleSpotifyLogin() {
            var accessToken = localStorage.getItem('accessToken');
            if (accessToken) {
                // Benutzer ist angemeldet
                document.getElementById('loggedInUser').innerText = localStorage.getItem('userDisplayName');
                document.getElementById('loggedInStatus').style.display = 'block';
                document.getElementById('loginButton').style.display = 'none';
            } else {
                // Benutzer ist nicht angemeldet
                document.getElementById('loggedInStatus').style.display = 'none';
                document.getElementById('loginButton').style.display = 'block';
            }
        }

        // Initialisierung bei Laden der Seite
        window.onload = function() {
            toggleSpotifyLogin(); // Überprüfe den Anmeldestatus
        };
    </script>

</body>
</html>
