<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Playlist Generator</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #333; /* Dunkler Hintergrund für Dark Mode */
            color: #fff; /* Weißer Text für bessere Lesbarkeit */
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #444; /* Dunklerer Hintergrund für das Formular */
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            text-align: left; /* Text linksbündig für Playlist */
        }
        h1 {
            color: #1DB954; /* Grün für den Titel */
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #fff; /* Weißer Text für Labels */
        }
        input[type="text"], input[type="number"] {
            width: calc(100% - 20px);
            padding: 8px;
            margin-bottom: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            background-color: #555; /* Dunklerer Hintergrund für Eingabefelder */
            color: #fff; /* Weißer Text für Eingabefelder */
            box-sizing: border-box;
        }
        button {
            background-color: #1DB954; /* Grün für den Button */
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        button.cancel-button {
            background-color: #ff4d4d; /* Rot für den Abbrechen-Button */
            margin-left: 10px;
        }
        button:hover {
            background-color: #1ed760; /* Dunkleres Grün im Hover-Zustand */
        }
        p.error-message {
            color: #ff4d4d; /* Rotes für Fehlermeldungen */
            font-size: 14px;
            margin-top: 8px;
            display: none; /* Fehlermeldung zunächst ausblenden */
        }
        .playlist {
            margin-top: 20px;
            border-top: 1px solid #666; /* Trennlinie für Playlist */
            padding-top: 10px;
        }
        .song-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .song-item img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            border-radius: 4px;
        }
        .song-item .song-info {
            flex: 1;
        }
        .song-item .song-info h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
        }
        .song-item .song-info p {
            margin: 0;
            font-size: 14px;
            color: #ccc;
        }
        .related-playlists {
            margin-top: 20px;
            display: none; /* Verstecke ähnliche Playlists zu Beginn */
        }
        .related-playlists.active {
            display: block; /* Zeige ähnliche Playlists nach Generierung */
        }
        .related-playlists h2 {
            color: #1DB954;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .related-playlist-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .related-playlist-item img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            border-radius: 4px;
        }
        .related-playlist-item .playlist-info {
            flex: 1;
        }
        .related-playlist-item .playlist-info h3 {
            margin: 0;
            font-size: 16px;
            color: #fff;
        }
        .related-playlist-item .playlist-info p {
            margin: 0;
            font-size: 14px;
            color: #ccc;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Spotify Playlist Generator</h1>

        <button id="loginButton" onclick="toggleSpotifyLogin()">Mit Spotify anmelden</button>
        <p id="loggedInStatus" style="display: none;">Angemeldet als: <span id="loggedInUser"></span> (<a href="#" onclick="logout()">Abmelden</a>)</p>

        <label for="inputField">Beschreibung:</label>
        <input type="text" id="inputField" placeholder="Gib hier deine Beschreibung ein">

        <label for="numSongs">Anzahl der Lieder:</label>
        <input type="number" id="numSongs" min="1" value="10">

        <button onclick="validateAndGenerate()">Generieren Playlist</button>
        <button class="cancel-button" onclick="reloadPage()">Abbrechen</button>
        <button id="saveToSpotifyButton" style="display: none;" onclick="saveToSpotify()">Auf Spotify speichern</button>

        <p id="generatedCount" style="display: none;">0/0 Liedern generiert</p>

        <div class="playlist" id="playlist">
            <!-- Hier werden die generierten Songs angezeigt -->
        </div>

        <div class="related-playlists" id="relatedPlaylists">
            <h2>Ähnliche Playlists auf Spotify</h2>
            <!-- Hier werden ähnliche Playlists angezeigt -->
        </div>

        <p id="errorMessage" class="error-message"></p>

        <!-- Verstecktes Div für benutzerdefinierten Text -->
        <div id="customText" style="display: none;">
            <!-- Hier kannst du deinen benutzerdefinierten Text als Vorlage eingeben -->
            <!-- Dieser Text wird im JavaScript als Vorlage verwendet, aber nicht auf der Website angezeigt -->
            Erstellt von K4sperl Musikdatenbank bereitgestellt von Spotify. Mithilfe von ChatGPT, MicrosoftCopilot und BlackBox.ai habe ich das hier geschafft und es ist erstaunlich was man mit etwas Gedult mit Ai erreichen kann.
        </div>
    </div>

    <script>
        // Global variables for access token and user display name
        var accessToken = localStorage.getItem('accessToken');
        var userDisplayName = localStorage.getItem('userDisplayName');

        // Function to toggle Spotify login/logout
        function toggleSpotifyLogin() {
            if (accessToken) {
                logout();
            } else {
                authorizeSpotify();
            }
        }

        // Function to initiate Spotify authorization
        function authorizeSpotify() {
            var scopes = 'playlist-read-private playlist-read-collaborative user-read-private';
            var url = 'https://accounts.spotify.com/authorize';
            url += '?response_type=code';
            url += '&client_id=' + encodeURIComponent('0fe8c6577bda455581b8b36be7631e25');
            url += '&scope=' + encodeURIComponent(scopes);
            url += '&redirect_uri=' + encodeURIComponent('https://k4sperl.github.io/Spotify-Playlist-Generator.github.io');

            var authWindow = window.open(url, '_blank');

            var interval = setInterval(function() {
                if (authWindow.closed) {
                    clearInterval(interval);
                    handleRedirect();
                }
            }, 1000);
        }

        // Function to handle redirect after Spotify authorization
        function handleRedirect() {
            var urlParams = new URLSearchParams(window.location.search);
            var code = urlParams.get('code');
            if (code) {
                // Send code to server to exchange for access token
                fetch('https://your-backend-server.com/spotify-auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ code: code }),
                })
                .then(response => response.json())
                .then(data => {
                    accessToken = data.access_token;
                    localStorage.setItem('accessToken', accessToken);
                    getUserInfo();
                })
                .catch(error => console.error('Error exchanging code for access token:', error));
            } else {
                console.error('Authorization code not found.');
            }
        }

        // Function to fetch user information from Spotify
        function getUserInfo() {
            fetch('https://api.spotify.com/v1/me', {
                headers: {
                    'Authorization': 'Bearer ' + accessToken,
                },
            })
            .then(response => response.json())
            .then(data => {
                userDisplayName = data.display_name;
                localStorage.setItem('userDisplayName', userDisplayName);
                showLoggedIn(userDisplayName);
            })
            .catch(error => console.error('Error fetching user information:', error));
        }

        // Function to display logged-in state
        function showLoggedIn(userName) {
            document.getElementById('loginButton').style.display = 'none';
            document.getElementById('loggedInStatus').style.display = 'block';
            document.getElementById('loggedInUser').textContent = userName;
            document.getElementById('saveToSpotifyButton').style.display = 'block';
        }

        // Function to log out
        function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('userDisplayName');
            location.reload(); // Reload page to update state
        }

        // Function to validate input and generate playlist
        function validateAndGenerate() {
            var inputText = document.getElementById("inputField").value.trim();
            var numSongs = parseInt(document.getElementById("numSongs").value, 10);

            // Validation
            if (inputText === "") {
                displayErrorMessage("Keine Eingabe");
            } else if (!isValidInput(inputText)) {
                displayErrorMessage("Ungültige Eingabe");
            } else if (numSongs <= 0) {
                displayErrorMessage("Ungültige Anzahl an Liedern");
            } else {
                var generatedText = document.getElementById("customText").textContent.trim();
                console.log("Benutzerdefinierter Text:", generatedText);
                document.getElementById("generatedCount").textContent = `0/${numSongs} Liedern generiert`;
                document.getElementById("generatedCount").style.display = "block"; // Show generation status

                // Generate songs and display
                generateSongs(inputText, numSongs);
                hideErrorMessage();

                // Load related playlists
                loadRelatedPlaylists();
            }
        }

        // Function to generate songs (dummy data for demonstration)
        function generateSongs(description, numSongs) {
            var generatedSongs = [];
            for (var i = 1; i <= numSongs; i++) {
                var song = {
                    id: i,
                    name: `Song ${i}`,
                    artist: `Künstler ${i}`,
                    image: 'https://via.placeholder.com/50', // Example image placeholder
                };
                generatedSongs.push(song);
            }
            displayPlaylist(generatedSongs);
        }

        // Function to display generated playlist
        function displayPlaylist(songs) {
            var playlistElement = document.getElementById("playlist");
            playlistElement.innerHTML = ""; // Clear playlist

            songs.forEach(function(song) {
                var songItem = document.createElement("div");
                songItem.classList.add("song-item");

                var songImage = document.createElement("img");
                songImage.src = song.image;
                songImage.alt = song.name;
                songItem.appendChild(songImage);

                var songInfo = document.createElement("div");
                songInfo.classList.add("song-info");

                var songName = document.createElement("h3");
                songName.textContent = song.name;
                songInfo.appendChild(songName);

                var artistName = document.createElement("p");
                artistName.textContent = song.artist;
                songInfo.appendChild(artistName);

                songItem.appendChild(songInfo);
                playlistElement.appendChild(songItem);
            });
        }

        // Function to load related playlists (dummy data for demonstration)
        function loadRelatedPlaylists() {
            var relatedPlaylists = [
                { id: 1, name: 'Ähnliche Playlist 1', image: 'https://via.placeholder.com/50' },
                { id: 2, name: 'Ähnliche Playlist 2', image: 'https://via.placeholder.com/50' },
                { id: 3, name: 'Ähnliche Playlist 3', image: 'https://via.placeholder.com/50' }
            ];
            displayRelatedPlaylists(relatedPlaylists);
        }

        // Function to display related playlists
        function displayRelatedPlaylists(playlists) {
            var relatedPlaylistsElement = document.getElementById("relatedPlaylists");
            relatedPlaylistsElement.innerHTML = ""; // Clear related playlists

            var heading = document.createElement("h2");
            heading.textContent = "Ähnliche Playlists auf Spotify";
            relatedPlaylistsElement.appendChild(heading);

            playlists.forEach(function(playlist) {
                var playlistItem = document.createElement("div");
                playlistItem.classList.add("related-playlist-item");

                var playlistImage = document.createElement("img");
                playlistImage.src = playlist.image;
                playlistImage.alt = playlist.name;
                playlistItem.appendChild(playlistImage);

                var playlistInfo = document.createElement("div");
                playlistInfo.classList.add("playlist-info");

                var playlistName = document.createElement("h3");
                playlistName.textContent = playlist.name;
                playlistInfo.appendChild(playlistName);

                playlistItem.appendChild(playlistInfo);
                relatedPlaylistsElement.appendChild(playlistItem);
            });

            relatedPlaylistsElement.classList.add("active"); // Show related playlists
        }

        // Function to display error message
        function displayErrorMessage(message) {
            var errorMessageElement = document.getElementById("errorMessage");
            errorMessageElement.textContent = `Fehler: ${message}`;
            errorMessageElement.style.display = "block";
        }

        // Function to hide error message
        function hideErrorMessage() {
            var errorMessageElement = document.getElementById("errorMessage");
            errorMessageElement.style.display = "none";
        }

        // Function to reload page
        function reloadPage() {
            location.reload();
        }

        // Function to validate input text
        function isValidInput(inputText) {
            return /^[a-zA-Z0-9\s]+$/.test(inputText); // Allow only alphanumeric characters and spaces
        }

        // Function to save playlist to Spotify (placeholder for actual implementation)
        function saveToSpotify() {
            var playlistName = prompt("Gib einen Namen für deine Playlist ein:");
            if (playlistName) {
                // Placeholder for saving playlist to Spotify
                alert(`Playlist "${playlistName}" wurde auf Spotify gespeichert!`);
            }
        }

        // Check if user is already logged in
        if (accessToken && userDisplayName) {
            showLoggedIn(userDisplayName);
        }
    </script>

</body>
</html>
